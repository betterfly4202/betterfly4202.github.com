---
title: "읽기 좋은 코드가 좋은 코드다"
layout: post
date: 2018-08-31 22:22
image: 
headerImage: true
tag: 
- 도서리뷰
- 읽기 좋은 코드가 좋은 코드다
- The Art of Readable Code
category: review
author: betterFLY
description:
---

### 읽기 좋은 코드가 좋은 코드다(The Art of Readable Code)

우리가 매일같이 쓰는 코딩 습관, 큰 의미 없이 선언하던 변수, 큰 고민을 하지 않고 양산하는 코드, 테스트 코드 등

책 전반에 걸쳐 효율적이고 생산적인 코딩습관, 그리고 동료와 함께할 수 있는 의미있는 코드를 작성하는 방법에 대하여 새심하게 기술되어 있다.

워낙 알짜배기 책이라 각 파트별 내용을 간추리고 싶지만, 그건 리뷰라기 보다는 그냥 책 요약본일 것이다.

전체적으로 버릴 내용이 없는 책이었지만, 그 중 특히 감명깊은 부분을 표기해두었는데, 그 부분에서 간략히 기록하려한다.

- 함수의 동작을 명확하게 설명하라

~~~java
    //이 파일에 담긴 줄 수를 반환한다.
    int CountLines(Stirng fileName){
        ...
    }
~~~

위 주석은 명확하지 않다. '줄'을 정의하는 방법이 여러가지 있을 수 있기 때문이다.
    - (빈 파일)은 줄 수가 0인가? 1인가?
    - "hello"는 줄 수가 0인가? 1인가?
    - "hello\n" 는 줄 수가 1인가 2인가?

등등 주석 또는 메서드명만 봐서는 정확한 명세를 확인하기 힘들다.

~~~java
    //파일 안에 새 줄을 나타내는 바이트('\n')가 몇 개 있는지 센다.
    int CountLines(String fileName){
        ...
    }
~~~

이 전 주석보다 긴 내용은 아니지만, 훨씬 명확한 설명을 해주는 주석이다.

---

의미 없는 주석, 형식적인 주석 다는 것을 피하기 위해서 나름 주석을 신경써서 작성하려고 노력했지만, 내가 썼던 주석 수준은 위와 같이 간단하고 추상적인 내용뿐이었다.

구체적으로 구구절절 나열하는 것이 아닌, 코드에 필요한 핵심 기능만 표현할 수 있는 주석으로 조금 더 신경써서 주석을 달아야겠다.


- 드모르간 법칙 사용하기
동일한 boolean 표현은 다음과 같이 두 가지 방법으로 작성 가능하다.

> 1) not (a or b or c) <-> (not a) and (not b) and (not c)
> 2) not (a and b and c) <-> (not a) or (not b) or (not c)

이러한 법칙은 *"not을 분배하고 and/or를 바꿔라"* 만을 기억하면 된다.

~~~java
    if(!(file_exists || is_protected)){
        Error("Error, cant not read files");
    }
~~~

위 내용은 다음과 같이 수정 가능하다.

~~~java
    if(!file_exists || is_protected){
        Error("Error, cant not read files");
    }
~~~

드모르간 법칙은 생소하게 들리지만, 사실 이런 연산은 아주아주 어렴풋이 기억 한 곳에 남아있는 집합 내용에서 떠올릴 수 있다.

위와 같은 연산을 통해 복잡한 분기를 피하고 최대한 깔끔한 연산을 적용하는 것을 잊지 말자.

---

- 생각을 코드로 만들기

> "할머니에게 설명할 수 없다면 당신은 제대로 이해한 게 아닙니다." \n -알버트 아인슈타인

코드를 명확하게 만드는 간단한 과정
1. 코드가 할 일을 옆의 동료하게 말하듯이 평범한 영어로 묘소하라.
2. 이 설명에 들어가는 핵심적인 단어와 문구를 포착하라.
3. 설명과 부합하는 코드를 작성하라.

~~~javascript

    var is_admin = is_admin_request(); //true/false
    if(document){
        if(!is_admin && is_user('userName') != is_user_session('userName')){
            return not_authorized();
        }
    }else{
        if(!is_admin){
            return not_authorized();
        }
    }

    // 계속해서 페이지를 렌더링...
~~~

위 코드를 살펴보면, 사용이 허가되는 방법은 두 경우이다.
1. 관리자 일 때
2. 만약 문서가 있다면, 유저가 세션의 유저와 같을때

위 경우 가아니면 허가되지 않는다.

위의 논리로 새로운 코드를 작성해보면 다음과 같다.

~~~javascript
    if(is_admin_reuqest()){
        //허가
    }else if(document && is_user('userName') == is_user_session('userName'){
        //허가
    }else{
        return not_authorized();
    }

    // 계속해서 페이지를 렌더링...
~~~

논리대로 정리하면 보다 직관적이고 명확하다. 무엇보다 부정문이 없어서 논리를 파악하기도 좋다.

이 장에서 두가지 큰 깨달음
- 할머니에게 설명할 수 없다면 제대로 이해하지 못한 것이다.
- 대화하듯이 논리의 흐름을 정리하고, 이를 단순하고 명료한 코드로 작성하는 것

생각이 복잡하고 정리가 되지 않으면, 그 소스코드 역시 파악하기 어렵고 설득력이 떨어진다.

최근 프로젝트에서 전체적인 비즈니스로직이 이해되지 않는 상황에서 급하게 소스를 작성하며 이런 경험이 있었다.

급한 마음에 일단 눈에 보이는 기능만 작동하도록 코드를 구현한 것이다.

이 코드는 당연히 일주일도 지나지 않아 문제가 발생했고, 꽤 복잡한 로직을 담고 있는 이 기능은 전체적으로 소스를 관리하기도 힘들어져서 결국 모든 내용을 지우고 처음부터 작성하는 것이 나을 것이라 판단되어 2~3일에 걸쳐 다시 작성했던 기억이 난다.

1. 전체 로직을 제대로 이해하지 못했고
2. 내가 이해되지 못했기 때문에 논리의 흐름이 정리될 수 없었고, 지저분하고 복잡한 코드를 낳았다.

세상 모든 일이 그러할 것이다.

무슨 일을 하더라도 내가 이것을 '왜' 해야 하고, '무엇을', '어떻게'할 것인지 흐름을 파악해야 한다.

---

- 코드 분량 줄이기

> 가장 일긱 쉬운 코드는 아무것도 없는 코드다.

*자기 주변에 있는 라이브러리에 친숙해져라.*
이미 대부분의 프로그래밍 언어에서 기본적으로 많은 라이브러리를 제공해준다.

우리는 이미 존재하는 라이브러리를 통해 자신의 문제를 쉽게 해결할 수 있다는 사실을 간과하고 있다.

* 매일 15분씩 자신의 표준 라이브러리에 있는 모든 함수/모듈/형 들의 이름을 읽어라. *

여기에는 C++의 표준 템플릿 라이브러리(STL), 자바 API 등 모두 포함된다.

전체를 암기할 것이 아니라, 대략적으로 그것들을 파악해 두고 "아! 이런 기능을 하는 API를 봤던 것 같은데!?" 와 같은 훈련이 되어 있다면 우리의 생산력이 보다 나아질 것이다.

Collection Framework를 사용하며 contains 라는 함수를 모르고 있었다.

예를들어 ArrayList 객체안에 내가 찾는 값이 있는지 여부를 찾기 위해서 아래와 같이 검증이 필요했다.

~~~java
    ArrayList<String> arr = new ArrayList<>();
    arr.add("betterFLY");
    arr.add("chungil");

    boolean flag = false;
    for(String temp : arr){
        if(temp=="betterFLY"){
            flag = true;
        }
    }
~~~

배열 전체를 검사해서 내가 원하는 값이 있을때 작업을 수행한다.

이 코드는 다음과 같이 간결하게 검증할 수 있다.

~~~java
    if(arr.contains("betterFLY")){
        flag = true;
    }
~~~

전체를 살필 필요 없이 contains 라는 메서드를 통해 아주 간단하게 검증할 수 있다!

이 뿐만 아니라, 우리가 일상적으로 고민하는 많은 것들 중 많은 것들이 이미 잘 정리되어 있다.

물론 그런 과정을 직접 구현하면서 생각하는 훈련을 하는 것도 좋지만, 이미 아주 쉽고 직관적으로 정리되어 있는것을 직접 구현할 만큼 우리는 한가롭지 않다.

---

- 좋은 테스트 입력값의 선택

올 초 나에게 가장 혼란과 큰 숙제를 남겨준 것 중 하나가 TDD(Test-Driven Development) 이다.

지금도 해결되지 않은, 앞으로 내가 더 성숙한(?) 개발자가 되어가며 풀어갈 숙제인데, 그 테스트와 관련된 내용이다.

테스트에 알맞은 입력값을 선택하는 기술이 있다.
~~~javascript
    checkScoreBeforeAfter("-5, 1, 4, -99998.43, 3", "3334.231, 785");
~~~

>가능하면 가장 간단한 입력으로 코드를 완전히 검사할 수 있어야 한다.

위 예제의 값들을 보면 *-99998.43*, *-3334.231*, *785* 와 같은 '시끄러운 값'이 있다.
이 수 들은 단지 '임의의 음수' 또는 '매우 큰 음수' 또는 '실수' 를 표현 하는 것으로 보인다.
음수가 필요하다면 간단한 음수 ('-9'), 매우 큰 음수가 필요하다면 '-1e100' 과 같이 의미가 뚜렷하고 직관적으로 표현하기 쉬운 수를 선택하는 것이 좋다.

테스트의 정확한 수치는 크게 중요하지 않다.(모든 경우가 그렇진 않겠지만)

자료형 별로 연산을 확인하기 위해서라면 최대한 간단한 수 또는 직관적으로 표현하기 좋은 수를 사용하는 것이 결과를 확인하는 것에도, 테스트를 진행하는 것에도 용이하다.


---

막상 정리하고 나니 많이 아쉬움이 남는다.

첫 리뷰이기도 하고, 책 내용에 버릴 것이 없어 모든 내용을 기록하고 싶지만

이번에 읽었을때는 이 부분이 눈에 띄었는데, 다음에 다시 읽으니 그때 몰랐던 부분이 다시 보여서 다시 체크한다면

내 자신을 리팩토링 혹은 디버깅하는 좋은 계기가 될 것이다.

읽은 책 중에 리뷰하고 싶은 책들이 너무 많다.

한번 읽고 흘려버리기에 너무나 아까운 내용들이고, 내 안 좋은 머리에 담을 수도 없어 너무 아깝다.

기록하고 상기시켜서 내 것으로 만들어야겠다.