---
title: "2018년 8월 21일_maven 빌드 삽질기"
layout: post
date: 2018-08-21 09:53
tag: maven
image: 
headerImage: true
projects: true
hidden: true # don't count this post in blog pagination
description: ""
category: project
author: betterFLY
externalLink: false
---

현재 작업 중인 프로젝트는 국내 운영쪽 서버와 해외에서 운영되는 서버 2가지 버전으로 빌드해야 한다.

리눅스의 웹로직 서버하에 배포되는데 서버 환경이 다르다보니 properties 쪽에 약간의 차이가 있어 따로 빌드를 한다.

그러던 중 문제가 발생했다.

정적인 이미지 파일의 경우 서버에 별도로 저장하여 관리중인데, 루트 경로가 다르다보니 해외서버에서 이미지 경로를 찾지 못하는 이슈이다.

예를들어, 국내는 /home/weblogic/~ , 해외는 /home/oracle/~ 

이와 같은 경로에 위치하는데,

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<weblogic-web-app
        xmlns="http://www.bea.com/ns/weblogic/90"
        xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd">



    <container-descriptor>
        <show-archived-real-path-enabled>true</show-archived-real-path-enabled>
    </container-descriptor>

    <virtual-directory-mapping>
        <local-path>/home/weblogic/v2_webresource_file/</local-path>
        <url-pattern>/webresource/*</url-pattern>
    </virtual-directory-mapping>

    <context-root>/v2</context-root>

    <!--
    <session-descriptor>
        <timeout-secs>7200</timeout-secs>
    </session-descriptor>
    -->
</weblogic-web-app>
```

이 중 <local-path> 부분을 빌드시 프로파일 환경에 따라 동적으로 구분해줄 필요가 있다.

사실 maven의 dependency 같은거야 mvn-repository 에서 가져다 쓴게 대부분이고, 간단한 프로파일 설정 정도만 수정해봤지

이렇게 빌드 환경을 구체적으로 커스터마이징해본적이 없어서 여전히 삽질 중이다.

일단 힌트는 

```xml
<plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-war-plugin</artifactId>
                <configuration>
                    <warSourceDirectory>${basedir}/src/main/webapp</warSourceDirectory>
                    <webResources>
                        <resource>
                            <filtering>true</filtering>
                            <directory>src/main/webapp/WEB-INF</directory>
                            <includes>
                                <include>weblogic.xml</include>
                            </includes>
                        </resource>
                    </webResources>
                    <warSourceDirectory>src/main/webapp/WEB-INF</warSourceDirectory>
                    <webXml>src/main/resources-${environment}/weblogic.xml</webXml>
                </configuration>
            </plugin>
```

이렇게 설정하니까 /resource-{profile}/weblogic.xml 의 파일이 ~wepapp/WEB-INF/web.xml 로 떨궈지는 것을 확인했다.

그렇다면 저 환경을 통해서  /resource-{profile}/weblogic.xml 의 파일이 web-inf 아래 web.xml로 떨궈졌다는 거니까...

일단 weblogic.xml파일을 읽어 들이는거 까지는 됐다면, 저걸 web.xml 파일로 떨굴 것이 아니라,

web-inf/weblogic.xml 파일로만 떨구는 방법을 찾으면되지 않을까

-- 2018.8.21 오전 10
