---
title: "Cookie 와 Session 에 대한 이야기"
categories: "WEB"
tags:
  - Cookie
  - Session 
---

얼마전 Cache에 대한 정확한 정의를 공부해야 겠다고 생각하던 찰나 중 어떤 평소 즐겨 보는 [창천향로님의 블로그](http://jojoldu.tistory.com/278?category=689637)에서 기술면접 질문을 접하게 되었다.

질문의 내용인 즉슨


~~~java
String user = httpSession.getAttribute("user");
~~~
> 질문 1)<br/>
  여기서 session의 값을 가져오는 key는 "user"입니다. 
  사용자 A가 접속해도 "user"로 값을 가져오고, 사용자 B가 접속해도 "user"로 가져오는데 어떻게 A와 B가 접속했을때 서로 다른 결과값을 받을수 있나요?
  


> 질문 2)<br/>
  본인이 만든 프로젝트는 톰캣을 내렸다가 올리면 로그인이 풀리지 않나요? 
  톰캣을 내렸다가 올려도 로그인이 풀리지 않으려면 어떻게 해야할까요?
  


> 질문 3)<br/>
  세션은 서버에 저장되고, 쿠키는 클라이언트에 저장된다고 하셨는데, 그럼 쿠키가 안되는 상황에서도 세션은 사용할 수 있나요?
  
  
---

질문을 고민하기전에 가장 먼저 **'왜'** 쿠키와 세션이라는 개념이 필요한지 살펴보는 것이 중요할 것 같다.

세션과 쿠키는 네트워크 망에서 서버와 클라이언트가 상호간 통신을 할 때 사용하는 수단을 말한다. 
이 기술들의 목적은 **"상태 유지"** 에 있다. 웹 환경에서 사용되는 HTTP 프로토콜은 서버와 클라이언트가 통신을 완료하면 연결을 끊어버린다. 

한번의 통신에 요청과 응답을 하나로 묶고 연결을 끊어버리는 프로토콜을 **무상태 프로토콜 (Stateless Protocol)** 이라고 한다. 

그러면 이 무상태 프로토콜이 필요한 이유는 무엇일까?

무상태 프로토콜의 가장 큰 장점은 통신을 하면서 발생하는 수많은 리소스를 절약할 수 있다는 것이다. 
무상태 프로토콜의 가장 대표적인 프로토콜은 HTTP이며, 주 목적은 웹 상에서 HTML 문서를 서빙하는 것이다.


세션과 쿠키는 하는일과 목적은 같지만 저장하는 방법에 따라 둘을 구분 짓는다.
**쿠키**는 클라이언(사용자) 로에 저장(보관), **세션**은 서버에 저장하므로,

쿠키는 사용자의 민감한 정보를 다루는 것은 매우 위험하고, 쇼핑몰로 예로들면 장바구니에 담는 사용자 쇼핑 기록 정도를 저장시 쿠키를 활용한다라고 말한다.

![쿠키세션비교](/assets/images/180607/compare_with_cookie_session.png)


---

그러면 다시 질문으로 돌아가서, 세션과 쿠키를 적절히 이용한다면 이 질문에 답을 할 수 있지 않을까

부끄럽지만 사실 위 질문 3개를 모두 처리해본 적이 없다. 
우선 내가 아는 선에서 1번 문제에 대한 답변을 정리해보았다.

    1. 이것이 질문의 요지에 맞는지 모르겠지만, 기본적으로 사용자가 해당 도메인에 접근시 톰캣(다른 WAS는 확인하지 못했다.)에서 클라이언트 고유의 SESSION ID를 할당해준다.
    
    이는 로그인 유무와도 무관하게 모든 사용자에게 부여되는 고유 ID이다. 따라서 "name"이라는 session 키 값에 해당 session id 값을 value로 하여 활용한다면, 유저간에 구분된 결과를 처리할 수 있지 않을까.
    이를 계속 유지시키기 위한다면 쿠키에 해당 SESSION ID 정보를 저장하여 활용할 수 있을 것이다.
     

    2. 이부분은 내용이 생소하여 검색을 해보니, 톰캣 내 설정으로 세션을 유지시키는 방법이 가능한 것 같다.
    톰캣의 server.xml 에 다음의 설정을 추가하자.

~~~xml
  <Manager className="org.apache.catalina.session.PersistentManager"
                     saveOnRestart="true"
                     maxActiveSessions="-1"
                     minIdleSwap="-1"
                     maxIdleSwap="-1"
                     maxIdleBackup="-1">
              <Store className="org.apache.catalina.session.FileStore" directory="/session" />
  </Manager>
~~~

**saveOnRestart** 이 부분이 세션을 유지시킬지 설정하는 것이기 떄문에 해당 부분을 false로 저장한다면, 서버 재구동시마다 세션 정보를 저장하지 않도록 처리할 수 있다.


    3. **Q. 세션은 서버에 저장되고, 쿠키는 클라이언트에 저장된다고 하셨는데, 그럼 쿠키가 안되는 상황에서도 세션은 사용할 수 있나요?**
    음.. 처음 질문을 보고 몇초간 질문의 의도가 파악되지 않아 당혹스러웠다. 쿠키가 안되는 상황.. 이라고하면 위에 표에 있는 쿠키 제한 사항 중
    - 현재 도메인에 20개 이상의 쿠키를 사용하는 경우
    - 쿠키의 사이즈가 4KB 이상인 경우
    - 해당 클라이언트에 300개 이상의 쿠키가 적재된 경우

    위 경우 쿠키의 사용이 제한되는것일 텐데, 이런 클라이언트의 환경이 세션이 저장되는 서버와 연관이 있을까?

